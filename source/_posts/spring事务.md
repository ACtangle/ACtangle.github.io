---
title: spring事务基础认识和配置讲解
toc: true
date: 2020-01-02 17:41:02
tags: spring
categories: 笔记
thumbnail: /gallery/thumbnails/spring事务.jpg
---
#### 注意：笔记只对作者有用，不能保证可靠性
<!--more-->

* 事务的特性：原子性、隔离性、持久性、一致性
***
* Spring为不同的框架提供了不同PlatformTransactionManager接口（事务管理器）的实现类
***
* TransactionDefinitions定义事务隔离级别（隔离级别为了解决脏读、幻读、不可重复读这几类问题），spring默认提供隔离级别为default，即后端系统使用的数据库默认的隔离级别
***
* 事务的传播行为：为了解决业务层方法（都有事务）之间相互调用的问题

重点可看1、4、7行为类型，各属三大类：
以下为图中的讲解：
![avatar](/articalPic/1.jpg)
1、第一类（在同一个事务内）：
    第一种：先到达a事务的方法如果存在就使用a的事务，如果a不存在事务，b存在事务就使用b事务
    第二种：先到达a事务的方法如果存在就使用a的事务，如果a不存在事务b就不使用事务
    第三种：先到达a事务的方法如果存在就使用a的事务，如果a不存在事务就抛出异常
2、第二类（不在同一个事务内）：
    第四种：如果a事务存在，就挂起当前事务，创建一个新的事务，此时a和b不在一个事务内
3、第三类（事务a后再事务b）：
    第七种：如果当前a事务存在，就使用嵌套事务
***
* TransactionStatus接口（事务状态）：获得或者判断事务的状态方法

***
* 编程式事务管理：通过配置transactionTemplate然后在业务层引入该bean去实现每个业务方法的回滚；
* 声明式事务有三种方式：
    * 1、基于AOP面向切面：通过配置代理类扩充业务类来实现动态代理，第二种与第一种的区别是第一种需要在业务层的方法内去手动变成，而第二种是在业务类引入业务类的代理类来统一业务的方法回滚（不常用，因为实际开发中对代理类的配置会很多）
    ![avatar](/articalPic/3.jpg)
    
    * 2、基于AspectJ的xml的配置：无须再业务类内引入代理类，自动生成（常用）
        * 1）配置事务增强
        * 2）配置切面
    ![avatar](/articalPic/2.jpg)

    * 3、基于注解方式的配置：（常用，最简单使用）
    ![avatar](/articalPic/4.jpg)
    ![avatar](/articalPic/5.png)


第二种配置后不用再业务层上增加代码，而第三种需要增加注解，看业务场景都可以使用
***

​    